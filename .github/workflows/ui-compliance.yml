name: ui-compliance

on:
  push:
    paths:
      - "ui/**"
      - "tools/**"
      - "data/**"
      - "sources/**"
      - ".github/workflows/ui-compliance.yml"
  pull_request:
    paths:
      - "ui/**"
      - "tools/**"
      - "data/**"
      - "sources/**"
      - ".github/workflows/ui-compliance.yml"

jobs:
  ui-compliance:
    runs-on: windows-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.13"
      - name: Setup Node
        uses: actions/setup-node@v6
        with:
          node-version: "20"
      - name: Install Node deps
        run: npm ci
      - name: Build CSS
        run: npm run build:css
      - name: Install python deps
        run: pip install jsonschema
      - name: Build UI index
        run: py tools/build_index.py
      - name: Lint content
        run: py tools/lint_content.py
      - name: Run UI compliance tests
        run: powershell -NoProfile -File tools/tests/ui_compliance_tests.ps1
      - name: Run product source validation tests
        run: powershell -NoProfile -File tools/tests/validate_product_sources_tests.ps1
      - name: Run snapshot tests
        run: powershell -NoProfile -File tools/tests/snapshot_tests.ps1
      - name: Run release snapshot tests
        run: powershell -NoProfile -File tools/tests/release_snapshot_tests.ps1
      - name: Run manifest verify tests
        run: powershell -NoProfile -File tools/tests/verify_snapshot_manifest_tests.ps1
      - name: Run Hugo integration tests
        run: powershell -NoProfile -File tools/tests/hugo_integration_tests.ps1
